<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Static CSP for external files only (no nonces needed) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'none';
    script-src 'self';
    style-src 'self';
    img-src 'self' data:;
    connect-src 'none';
    font-src 'none';
    object-src 'none';
    frame-ancestors 'none';
    base-uri 'none';
    form-action 'none';
    upgrade-insecure-requests;
    require-trusted-types-for 'script'
  ">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="no-referrer" />
  <title>x4 — Four-Layer Encryption (PBKDF2, external assets)</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>
  </div>

  <div class="wrap">
    <header class="fade">
      <div class="brand">
        <span class="logo">x4</span>
        <span>Four-Layer Encryption</span>
      </div>
      <h1 class="headline">AES‑GCM (256) with PBKDF2 hardening</h1>
      <p class="sub">Client‑side only. Strong KDF, unique salts and IVs per layer, tamper‑evident header.</p>
      <div class="badges">
        <span class="badge info">AES‑GCM 256</span>
        <span class="badge info">PBKDF2 (HMAC‑SHA‑256/512)</span>
        <span class="badge ok">4 independent layers</span>
      </div>
    </header>

    <div class="tabs">
      <button id="tab-enc" class="tab active" type="button" role="tab" aria-selected="true" aria-controls="sec-enc">Encrypt</button>
      <button id="tab-dec" class="tab" type="button" role="tab" aria-selected="false" aria-controls="sec-dec">Decrypt</button>
    </div>

    <!-- Encrypt (visible by default) -->
    <section id="sec-enc" class="fade" role="tabpanel" aria-labelledby="tab-enc">
      <div class="card">
        <div class="section-title">Encrypt your message</div>
        <div class="hint">Use long, unique passwords. Header is AAD‑bound for tamper protection.</div>

        <div class="grid mt-3">
          <div>
            <label class="label" for="enc-msg">Message</label>
            <textarea id="enc-msg" class="textarea" placeholder="Type or paste your text to encrypt..." spellcheck="false"></textarea>
          </div>

          <div class="grid grid-2">
            <div>
              <label class="label" for="enc-p1">First password</label>
              <div class="row">
                <input id="enc-p1" type="password" class="input" placeholder="Enter first password..." autocomplete="new-password" spellcheck="false">
                <button class="eye" type="button" data-for="enc-p1" aria-label="Toggle visibility">👁️</button>
              </div>
            </div>
            <div>
              <label class="label" for="enc-p2">Second password</label>
              <div class="row">
                <input id="enc-p2" type="password" class="input" placeholder="Enter second password..." autocomplete="new-password" spellcheck="false">
                <button class="eye" type="button" data-for="enc-p2" aria-label="Toggle visibility">👁️</button>
              </div>
            </div>
          </div>

          <div class="card subcard">
            <div class="grid grid-3">
              <div>
                <label class="label" for="pbkdf2-iters">PBKDF2 iterations</label>
                <input id="pbkdf2-iters" type="number" class="input" min="120000" step="10000" value="600000" inputmode="numeric">
              </div>
              <div>
                <label class="label" for="pbkdf2-hash">PBKDF2 hash</label>
                <select id="pbkdf2-hash" class="select">
                  <option value="SHA-256" selected>SHA‑256</option>
                  <option value="SHA-512">SHA‑512</option>
                </select>
              </div>
              <div class="align-end">
                <button id="pbkdf2-cal" class="btn light block" type="button" aria-busy="false" data-busy-text="Calibrating...">
                  <span class="btn-spinner" aria-hidden="true"></span>
                  <span class="btn-text">⏱️ Calibrate (~300ms)</span>
                </button>
              </div>
            </div>
          </div>

          <div class="grid grid-2 mt-2">
            <button id="btn-enc" class="btn primary block" type="button" aria-busy="false" data-busy-text="Encrypting...">
              <span class="btn-spinner" aria-hidden="true"></span>
              <span class="btn-text">🔐 Encrypt</span>
            </button>
            <button id="btn-enc-clear" class="btn light block" type="button">
              <span class="btn-text">🧹 Clear</span>
            </button>
          </div>

          <div class="mt-3">
            <div class="result-title">Encrypted output (self-describing)</div>
            <div class="row mt-1">
              <textarea id="enc-out" class="textarea" placeholder="Result appears here..." readonly></textarea>
              <div class="tooltip" id="tip-enc">Copied!</div>
            </div>
            <div class="right mt-1">
              <button id="copy-enc" class="btn accent" type="button">
                <span class="btn-text">📋 Copy</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Decrypt (hidden by default) -->
    <section id="sec-dec" class="fade hidden" role="tabpanel" aria-labelledby="tab-dec">
      <div class="card">
        <div class="section-title">Decrypt your message</div>
        <div class="hint">Paste the text (starts with x4v2|...). Header is authenticated; altering it breaks decryption.</div>

        <div class="grid mt-3">
          <div>
            <label class="label" for="dec-in">Encrypted input</label>
            <textarea id="dec-in" class="textarea" placeholder="Paste ciphertext here..." spellcheck="false"></textarea>
            <div id="kdf-detected" class="hint mt-1"></div>
          </div>

          <div class="grid grid-2">
            <div>
              <label class="label" for="dec-p1">First password</label>
              <div class="row">
                <input id="dec-p1" type="password" class="input" placeholder="Enter first password..." autocomplete="current-password" spellcheck="false">
                <button class="eye" type="button" data-for="dec-p1" aria-label="Toggle visibility">👁️</button>
              </div>
            </div>
            <div>
              <label class="label" for="dec-p2">Second password</label>
              <div class="row">
                <input id="dec-p2" type="password" class="input" placeholder="Enter second password..." autocomplete="current-password" spellcheck="false">
                <button class="eye" type="button" data-for="dec-p2" aria-label="Toggle visibility">👁️</button>
              </div>
            </div>
          </div>

          <div class="grid grid-2 mt-2">
            <button id="btn-dec" class="btn primary block" type="button" aria-busy="false" data-busy-text="Decrypting...">
              <span class="btn-spinner" aria-hidden="true"></span>
              <span class="btn-text">🔓 Decrypt</span>
            </button>
            <button id="btn-dec-clear" class="btn light block" type="button">
              <span class="btn-text">🧹 Clear</span>
            </button>
          </div>

          <div class="mt-3">
            <div class="result-title">Decrypted output</div>
            <div class="row mt-1">
              <textarea id="dec-out" class="textarea" placeholder="Plaintext appears here..." readonly></textarea>
              <div class="tooltip" id="tip-dec">Copied!</div>
            </div>
            <div class="right mt-1">
              <button id="copy-dec" class="btn accent" type="button">
                <span class="btn-text">📋 Copy</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <span class="brandtxt">x4</span> • Enhanced client‑side encryption (PBKDF2)
    </footer>
  </div>

  <script src="./app.js" defer></script>
</body>
</html>
